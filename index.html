<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Feora Oil">
<meta name="theme-color" content="#1a2456">
<meta name="description" content="Feora Oil - Profesyonel Ã–n Muhasebe Sistemi">
<link rel="manifest" href="manifest.json">
<title>Feora Oil - Ã–n Muhasebe</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  /* FEORA OIL â€” Minimal Palette */
  --navy:#1a2456;
  --crimson:#cc1f1f;
  --crimson-light:#d63030;

  --bg:#09090f;
  --s1:#0e0e18;
  --s2:#12121e;
  --border:rgba(255,255,255,0.06);
  --border-sub:rgba(255,255,255,0.04);
  --surface:rgba(255,255,255,0.04);
  --surface2:rgba(255,255,255,0.07);

  --text:#e8eaf0;
  --text2:#9098b8;
  --muted:#505878;
  --muted2:#7080a8;

  --accent:#cc1f1f;
  --positive:#3d9e6a;
  --warn:#b07820;
  --info:#3a6dbf;

  --gradient-primary:linear-gradient(135deg,#1a2456,#141c46);
  --gradient-accent:var(--crimson);

  --font:'Outfit',sans-serif;
  --mono:'DM Mono',monospace;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bot:env(safe-area-inset-bottom,0px);
  --nav-h:64px;
  --header-h:58px;
  --r:14px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;background:var(--bg);}
body{font-family:var(--font);color:var(--text);display:flex;flex-direction:column;position:relative;}
*{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}

/* no orbs â€” removed for cleanliness */
.orb{display:none;}

/* HEADER */
#header{
  position:fixed;top:0;left:0;right:0;z-index:200;
  height:calc(var(--header-h) + var(--safe-top));
  padding-top:var(--safe-top);
  background:rgba(9,9,15,0.95);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  padding-left:16px;padding-right:16px;
}
.header-logo{display:flex;align-items:center;gap:10px;}
.logo-icon{width:34px;height:34px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.logo-name{display:flex;align-items:baseline;font-size:16px;font-weight:800;letter-spacing:-.3px;}
.logo-name .feora{color:var(--text);}
.logo-name .oil{color:var(--crimson);}
.logo-sub{font-size:8px;font-weight:600;color:var(--muted);letter-spacing:.3px;margin-top:1px;}
.logo-wrap{display:flex;flex-direction:column;gap:1px;}
.header-right{display:flex;gap:8px;align-items:center;}

/* KUR CHIPS */
.kur-mini{display:flex;gap:4px;}
.kc{
  background:var(--surface);border:1px solid var(--border);
  border-radius:8px;padding:4px 8px;
  font-size:11px;font-family:var(--mono);
  display:flex;align-items:center;gap:3px;
}
.kc-val{font-weight:600;color:var(--text2);}
.kc-chg{font-size:9px;}
.kc-chg.up{color:var(--text2);}
.kc-chg.dn{color:var(--crimson-light);}

.bell{
  width:34px;height:34px;
  background:var(--surface);border:1px solid var(--border);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  font-size:15px;cursor:pointer;position:relative;
}
.bell:active{background:var(--surface2);}
.bell-dot{position:absolute;top:6px;right:6px;width:6px;height:6px;background:var(--crimson);border-radius:50%;border:1.5px solid var(--bg);}

/* SCROLL CONTENT */
#content{
  position:fixed;
  top:calc(var(--header-h) + var(--safe-top));
  bottom:calc(var(--nav-h) + var(--safe-bot));
  left:0;right:0;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;z-index:1;
}
#content::-webkit-scrollbar{width:0;}
#content{scrollbar-width:none;}
.page{display:none;padding:16px 14px 12px;min-height:100%;}
.page.active{display:block;animation:pgIn .22s ease;}
@keyframes pgIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* BOTTOM NAV */
#bottomnav{
  position:fixed;bottom:0;left:0;right:0;z-index:200;
  height:calc(var(--nav-h) + var(--safe-bot));
  padding-bottom:var(--safe-bot);
  background:rgba(9,9,15,0.97);backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  display:flex;align-items:stretch;
}
.nav-tab{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:4px;cursor:pointer;padding:8px 0;
  color:var(--muted);transition:color .15s;position:relative;
}
.nav-tab.active{color:var(--text);}
.nav-tab.active::after{
  content:'';position:absolute;bottom:0;left:30%;right:30%;height:2px;
  background:var(--crimson);border-radius:2px 2px 0 0;
}
.nav-icon{font-size:18px;line-height:1;}
.nav-lbl{font-size:10px;font-weight:600;letter-spacing:.2px;}

/* MORE SHEET */
#more-sheet{
  position:fixed;bottom:0;left:0;right:0;z-index:300;
  background:var(--s1);
  border-top:1px solid var(--border);
  border-radius:20px 20px 0 0;
  padding:10px 14px calc(18px + var(--safe-bot));
  transform:translateY(100%);transition:transform .3s cubic-bezier(.25,.46,.45,.94);
  box-shadow:0 -8px 32px rgba(0,0,0,.5);
}
#more-sheet.open{transform:translateY(0);}
.sheet-handle{width:36px;height:3px;background:var(--border);border-radius:2px;margin:0 auto 16px;}
.sheet-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:12px;}
.sheet-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.sheet-item{
  background:var(--surface);border:1px solid var(--border);
  border-radius:12px;padding:14px;
  display:flex;flex-direction:column;align-items:flex-start;gap:5px;
  cursor:pointer;transition:background .15s;
}
.sheet-item:active{background:var(--surface2);}
.sheet-item-icon{font-size:18px;line-height:1;}
.sheet-item-label{font-size:13px;font-weight:700;color:var(--text);}
.sheet-item-sub{font-size:11px;color:var(--muted2);}
#more-overlay{position:fixed;inset:0;z-index:299;background:rgba(0,0,0,.5);display:none;}
#more-overlay.open{display:block;}

/* STAT CARDS */
.stat-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
.stat-row.three{grid-template-columns:1fr 1fr 1fr;}
.sc{
  background:var(--surface);border:1px solid var(--border);
  border-radius:14px;padding:14px;position:relative;overflow:hidden;
}
.sc:active{opacity:.85;}
.sc-orb{display:none;}
.sc-ico{font-size:17px;margin-bottom:8px;display:block;}
.sc-lbl{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;}
.sc-val{font-size:18px;font-weight:700;font-family:var(--mono);margin-top:4px;letter-spacing:-.3px;line-height:1.1;}
.sc-val.blue{color:var(--text2);}
.sc-val.teal{color:var(--text2);}
.sc-val.red{color:var(--crimson-light);}
.sc-val.orange{color:var(--text2);}
.sc-val.purple{color:var(--muted2);}
.sc-val.yellow{color:var(--text2);}
.sc-sub{font-size:10px;color:var(--muted2);margin-top:2px;}
.sc-sub.up{color:var(--text2);}
.sc-sub.dn{color:var(--crimson-light);}

/* CARDS */
.card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;margin-bottom:10px;overflow:hidden;
}
.card-head{display:flex;align-items:center;justify-content:space-between;padding:13px 14px;border-bottom:1px solid var(--border-sub);}
.card-title{font-size:13px;font-weight:700;color:var(--text2);}
.card-body{padding:12px 14px;}
.card-head a{font-size:12px;color:var(--muted2);cursor:pointer;font-weight:600;}

/* LIST ITEMS */
.list-item{
  display:flex;align-items:center;gap:10px;padding:11px 0;
  border-bottom:1px solid var(--border-sub);
}
.list-item:last-child{border-bottom:none;}
.list-item:active{opacity:.7;}
.li-ico{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;background:var(--surface2);}
.li-main{flex:1;min-width:0;}
.li-title{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.li-sub{font-size:11px;color:var(--muted2);margin-top:2px;}
.li-right{text-align:right;flex-shrink:0;}
.li-val{font-family:var(--mono);font-size:13px;font-weight:700;}

/* BADGES */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:20px;font-size:10px;font-weight:600;white-space:nowrap;letter-spacing:.1px;}
.b-blue{background:var(--surface);color:var(--muted2);border:1px solid var(--border);}
.b-teal{background:var(--surface);color:var(--muted2);border:1px solid var(--border);}
.b-orange{background:var(--surface);color:var(--muted2);border:1px solid var(--border);}
.b-red{background:rgba(204,31,31,.1);color:var(--crimson-light);border:1px solid rgba(204,31,31,.2);}
.b-purple{background:var(--surface);color:var(--muted2);border:1px solid var(--border);}
.b-yellow{background:var(--surface);color:var(--muted2);border:1px solid var(--border);}
.b-gray{background:rgba(80,88,120,.1);color:var(--muted2);border:1px solid rgba(80,88,120,.2);}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:12px 18px;border-radius:12px;font-size:14px;font-weight:600;font-family:var(--font);cursor:pointer;border:none;transition:opacity .15s,transform .1s;letter-spacing:-.1px;}
.btn:active{transform:scale(.96);opacity:.85;}
.btn-primary{background:var(--crimson);color:#fff;}
.btn-teal{background:var(--gradient-accent);color:#fff;}
.btn-ghost{background:var(--surface);color:var(--text);border:1px solid var(--border);}
.btn-ghost:active{background:var(--surface2);}
.btn-danger{background:rgba(204,31,31,.08);color:var(--crimson-light);border:1px solid rgba(204,31,31,.18);}
.btn-full{width:100%;}
.btn-sm{padding:7px 12px;font-size:12px;border-radius:9px;}

/* FAB */
.fab{
  position:fixed;right:16px;bottom:calc(var(--nav-h) + var(--safe-bot) + 14px);
  width:52px;height:52px;border-radius:16px;z-index:150;
  background:var(--crimson);
  display:flex;align-items:center;justify-content:center;
  font-size:24px;color:#fff;cursor:pointer;
  box-shadow:0 4px 16px rgba(204,31,31,.35);
  transition:transform .12s,box-shadow .12s;
}
.fab:active{transform:scale(.91);box-shadow:0 2px 8px rgba(204,31,31,.25);}

/* TABS */
.tabs{display:flex;gap:2px;background:var(--surface);padding:3px;border-radius:10px;margin-bottom:12px;border:1px solid var(--border);overflow-x:auto;-webkit-overflow-scrolling:touch;}
.tabs::-webkit-scrollbar{display:none;}
.tab{padding:7px 12px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;border:none;background:none;color:var(--muted);font-family:var(--font);white-space:nowrap;transition:.15s;}
.tab.active{background:var(--surface2);color:var(--text);border:1px solid var(--border);}

/* CHART */
.chart-wrap{display:flex;flex-direction:column;gap:6px;height:auto;}
.chart-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;}
.chart-bars{display:flex;gap:3px;align-items:flex-end;height:72px;}
.bar{width:10px;border-radius:3px 3px 0 0;transition:height .7s ease;}
.bar.inc{background:var(--muted);opacity:1;}
.bar.exp{background:var(--muted2);opacity:1;}
.chart-lbl{font-size:9px;color:var(--muted);font-weight:600;}
.chart-bars-row{display:flex;align-items:flex-end;gap:6px;height:72px;}

/* PROGRESS */
.prog{margin-bottom:10px;}
.prog-row{display:flex;justify-content:space-between;font-size:11px;margin-bottom:4px;}
.prog-row span:first-child{color:var(--muted2);}
.prog-row span:last-child{font-family:var(--mono);font-weight:600;color:var(--text2);}
.prog-track{background:var(--surface2);border-radius:20px;height:4px;overflow:hidden;}
.prog-fill{height:100%;border-radius:20px;transition:width 1s ease;}

/* ALARM */
.alarm-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border-sub);}
.alarm-item:last-child{border-bottom:none;}
.alarm-ico{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;background:var(--surface2);}
.alarm-txt{flex:1;min-width:0;}
.alarm-ttl{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.alarm-dt{font-size:10px;color:var(--muted2);margin-top:1px;}
.alarm-days{font-size:11px;font-weight:700;white-space:nowrap;}

/* MODAL */
.overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,.7);opacity:0;pointer-events:none;transition:opacity .2s;}
.overlay.open{opacity:1;pointer-events:all;}
.modal{
  position:fixed;bottom:0;left:0;right:0;z-index:501;
  background:var(--s1);
  border:1px solid var(--border);
  border-radius:20px 20px 0 0;
  padding:0 0 calc(16px + var(--safe-bot));
  max-height:92vh;overflow-y:auto;
  transform:translateY(100%);transition:transform .28s cubic-bezier(.25,.46,.45,.94);
}
.overlay.open .modal{transform:translateY(0);}
.modal-handle{width:36px;height:3px;background:var(--border);border-radius:2px;margin:10px auto 0;}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:14px 18px 12px;border-bottom:1px solid var(--border);}
.modal-title{font-size:16px;font-weight:700;letter-spacing:-.2px;}
.modal-close{background:var(--surface);border:1px solid var(--border);color:var(--muted2);font-size:16px;cursor:pointer;width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;}
.modal-close:active{background:var(--surface2);}
.modal-body{padding:16px 18px;}
.modal-foot{padding:14px 18px 0;display:flex;gap:8px;}

/* FORM */
.fg{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;}
.fg.one{grid-template-columns:1fr;}
.ff{display:flex;flex-direction:column;gap:4px;}
.fl{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;}
.fi{
  background:var(--surface);border:1px solid var(--border);
  color:var(--text);padding:11px 12px;border-radius:10px;
  font-size:14px;font-family:var(--font);outline:none;
  transition:border-color .15s,background .15s;
  -webkit-appearance:none;
}
.fi:focus{border-color:rgba(204,31,31,.4);background:var(--surface2);}
.fi::placeholder{color:var(--muted);}
select.fi option{background:var(--s1);color:var(--text);}
textarea.fi{resize:none;min-height:72px;}

/* INV ROWS */
.inv-row{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:6px;display:flex;flex-direction:column;gap:6px;}
.inv-row-top{display:flex;gap:6px;}
.inv-row-bot{display:grid;grid-template-columns:1fr 1fr 1fr 28px;gap:6px;align-items:center;}
.inv-total-box{
  background:var(--surface);border:1px solid var(--border);
  border-radius:12px;padding:14px;margin-top:10px;
}
.itr{display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px;color:var(--muted2);}
.itr span:last-child{font-family:var(--mono);color:var(--text);}
.itr.main{font-size:15px;font-weight:700;margin-bottom:0;margin-top:10px;padding-top:10px;border-top:1px solid var(--border);}
.itr.main span:last-child{color:var(--text);font-size:17px;}

/* TOAST */
.toast{
  position:fixed;top:calc(var(--header-h) + var(--safe-top) + 10px);
  left:50%;transform:translateX(-50%) translateY(-16px);z-index:999;
  background:var(--s1);border:1px solid var(--border);
  border-radius:10px;padding:10px 18px;
  font-size:13px;font-weight:600;color:var(--text);
  box-shadow:0 8px 32px rgba(0,0,0,.4);
  opacity:0;transition:opacity .22s,transform .22s;white-space:nowrap;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.err{border-color:rgba(204,31,31,.3);}

/* INSTALL PROMPT */
#install-banner{
  display:none;background:var(--surface);border:1px solid var(--border);
  border-radius:14px;padding:14px;margin-bottom:12px;align-items:center;gap:10px;
}
#install-banner.show{display:flex;}
.install-txt{flex:1;}
.install-ttl{font-size:13px;font-weight:700;}
.install-sub{font-size:11px;color:var(--muted2);margin-top:1px;}

/* EMPTY */
.empty-s{text-align:center;padding:40px 20px;color:var(--muted);}
.empty-s .ei{font-size:28px;margin-bottom:8px;opacity:.5;}
.empty-s p{font-size:12px;font-weight:500;}

/* SEARCH BAR */
.search-bar{position:relative;margin-bottom:10px;}
.search-inp{width:100%;background:var(--surface);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:10px;font-size:14px;font-family:var(--font);outline:none;-webkit-appearance:none;}
.search-inp:focus{border-color:rgba(204,31,31,.3);background:var(--surface2);}
.search-inp::placeholder{color:var(--muted);}

/* SEC TITLE */
.sec-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;margin:14px 0 8px;padding-left:2px;}

/* STATUS SELECT */
.sel-sm{background:var(--surface);border:1px solid var(--border);color:var(--text);padding:5px 7px;border-radius:8px;font-size:11px;font-family:var(--font);-webkit-appearance:none;outline:none;}

/* DEL BUTTON */
.del-btn{background:none;border:none;color:var(--muted);cursor:pointer;padding:5px;font-size:14px;border-radius:6px;transition:.12s;}
.del-btn:active{color:var(--crimson-light);}

/* KAR ZARAR ROW */
.kz-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border-sub);}
.kz-row:last-child{border-bottom:none;}
.kz-lbl{font-size:12px;color:var(--muted2);}
.kz-val{font-family:var(--mono);font-size:13px;font-weight:700;}

/* DASHBOARD EXTRAS */
.ds-hero{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:12px;position:relative;overflow:hidden;}
.ds-hero-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;}
.ds-hero-val{font-size:28px;font-weight:700;font-family:var(--mono);letter-spacing:-.5px;}
.ds-hero-sub{font-size:11px;color:var(--muted2);margin-top:3px;}

/* ACCENT BORDERS */
.sc.accent-red{border-left:2px solid var(--crimson);}
.sc.accent-navy{border-left:2px solid #1a2456;}
.li-ico.navy{background:var(--surface2);}
.li-ico.red{background:rgba(204,31,31,.08);}


/* ========== PIN LOCK SCREEN ========== */
#pin-screen{
  position:fixed;inset:0;z-index:9999;
  background:var(--bg);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:32px;
}
#pin-screen.hidden{display:none;}
.pin-logo{text-align:center;margin-bottom:36px;}
.pin-logo-icon{font-size:36px;margin-bottom:8px;opacity:.7;}
.pin-logo-name{font-size:22px;font-weight:800;letter-spacing:-.3px;}
.pin-logo-name span{color:var(--crimson);}
.pin-logo-sub{font-size:11px;color:var(--muted);margin-top:4px;}
.pin-label{font-size:13px;font-weight:600;color:var(--muted2);text-align:center;margin-bottom:20px;}
.pin-dots{display:flex;gap:12px;justify-content:center;margin-bottom:32px;}
.pin-dot{width:14px;height:14px;border-radius:50%;background:var(--surface2);border:1px solid var(--border);transition:.15s;}
.pin-dot.filled{background:var(--crimson);border-color:var(--crimson);}
.pin-dot.shake{animation:shake .35s ease;}
@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}}
.pin-pad{display:grid;grid-template-columns:repeat(3,68px);gap:10px;justify-content:center;}
.pin-key{
  width:68px;height:68px;border-radius:16px;
  background:var(--surface);border:1px solid var(--border);
  color:var(--text);font-size:20px;font-weight:600;font-family:var(--font);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:.1s;
}
.pin-key:active{background:var(--surface2);transform:scale(.93);}
.pin-key.action{font-size:13px;color:var(--muted2);}
.pin-err{font-size:12px;color:var(--crimson-light);text-align:center;margin-top:14px;min-height:16px;font-weight:600;}
.pin-setup-info{font-size:11px;color:var(--muted);text-align:center;margin-top:16px;line-height:1.5;}

/* ========== USD FÄ°YATLAMA ========== */
.usd-badge{display:inline-flex;align-items:center;gap:4px;background:var(--surface);border:1px solid var(--border);color:var(--muted2);padding:3px 8px;border-radius:8px;font-size:11px;font-weight:600;cursor:pointer;}
.cur-toggle{display:flex;gap:4px;margin-bottom:10px;}
.cur-btn{padding:6px 12px;border-radius:8px;font-size:12px;font-weight:600;border:1px solid var(--border);background:var(--surface);color:var(--muted2);cursor:pointer;font-family:var(--font);transition:.12s;}
.cur-btn.active{background:var(--surface2);color:var(--text);border-color:rgba(255,255,255,.12);}

/* ========== FATURA PRINT ========== */
@media print{
  body>*:not(#print-area){display:none!important;}
  #print-area{display:block!important;position:fixed;inset:0;background:#fff;color:#000;padding:24px;font-family:Arial,sans-serif;z-index:99999;}
  #print-area *{color:#000!important;}
}
#print-area{display:none;}
.print-invoice{max-width:700px;margin:0 auto;font-family:Arial,sans-serif;color:#111;}
.print-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:28px;padding-bottom:16px;border-bottom:2px solid #1a2456;}
.print-company{font-size:22px;font-weight:900;color:#1a2456;}
.print-company-sub{font-size:10px;color:#555;margin-top:3px;max-width:260px;line-height:1.4;}
.print-inv-info{text-align:right;}
.print-inv-no{font-size:20px;font-weight:700;color:#cc1f1f;}
.print-parties{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px;}
.print-party-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:#888;margin-bottom:5px;}
.print-party-name{font-size:14px;font-weight:700;}
.print-party-info{font-size:11px;color:#555;margin-top:2px;}
.print-table{width:100%;border-collapse:collapse;margin-bottom:20px;}
.print-table th{background:#1a2456;color:#fff;padding:10px 12px;font-size:11px;text-align:left;}
.print-table td{padding:10px 12px;font-size:12px;border-bottom:1px solid #eee;}
.print-table tr:nth-child(even) td{background:#f9f9f9;}
.print-totals{margin-left:auto;width:260px;}
.print-total-row{display:flex;justify-content:space-between;padding:6px 0;font-size:12px;border-bottom:1px solid #eee;}
.print-total-row.final{font-size:16px;font-weight:900;color:#1a2456;border-top:2px solid #1a2456;border-bottom:none;padding-top:10px;margin-top:4px;}
.print-footer{margin-top:32px;padding-top:14px;border-top:1px solid #ddd;font-size:10px;color:#888;text-align:center;line-height:1.6;}
.print-stamp{display:inline-block;border:3px solid #1a2456;border-radius:50%;padding:10px 16px;color:#1a2456;font-weight:900;font-size:11px;transform:rotate(-15deg);opacity:.7;margin-top:12px;}

/* ========== FATURA FOTOÄRAF TARAMA ========== */
#fat-scan-overlay{
  position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,.85);
  display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px;
  backdrop-filter:blur(8px);
}
#fat-scan-overlay.open{display:flex;}
.scan-box{
  width:260px;height:320px;border-radius:16px;
  border:1px solid var(--border);position:relative;overflow:hidden;
  background:rgba(255,255,255,.03);
}
.scan-img{width:100%;height:100%;object-fit:cover;border-radius:14px;display:none;}
.scan-img.visible{display:block;}
.scan-line{
  position:absolute;left:0;right:0;height:1px;background:rgba(255,255,255,.4);
  box-shadow:none;
  animation:scanMove 2s ease-in-out infinite;
}
@keyframes scanMove{0%{top:0;}50%{top:calc(100% - 2px);}100%{top:0;}}
.scan-corner{position:absolute;width:16px;height:16px;border-color:rgba(255,255,255,.5);border-style:solid;}
.scan-corner.tl{top:8px;left:8px;border-width:2px 0 0 2px;}
.scan-corner.tr{top:8px;right:8px;border-width:2px 2px 0 0;}
.scan-corner.bl{bottom:8px;left:8px;border-width:0 0 2px 2px;}
.scan-corner.br{bottom:8px;right:8px;border-width:0 2px 2px 0;}
.scan-status{font-size:13px;font-weight:600;color:var(--text2);text-align:center;max-width:260px;}
.scan-sub{font-size:11px;color:var(--muted);text-align:center;}
.scan-result-preview{
  background:var(--s1);border:1px solid var(--border);border-radius:14px;
  padding:14px;width:280px;max-height:280px;overflow-y:auto;display:none;
}
.scan-result-preview.open{display:block;}
.scan-field{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border-sub);font-size:12px;}
.scan-field:last-child{border-bottom:none;}
.scan-field-key{color:var(--muted2);font-weight:600;}
.scan-field-val{color:var(--text);font-weight:700;text-align:right;max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}

/* ========== BACKUP / RESTORE ========== */
.backup-actions{display:flex;flex-direction:column;gap:8px;margin-top:4px;}
.backup-btn{display:flex;align-items:center;gap:10px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 14px;cursor:pointer;transition:.12s;color:var(--text);font-family:var(--font);width:100%;}
.backup-btn:active{background:var(--surface2);}
.backup-btn-ico{font-size:18px;width:28px;text-align:center;}
.backup-btn-txt{text-align:left;}
.backup-btn-ttl{font-size:13px;font-weight:600;}
.backup-btn-sub{font-size:11px;color:var(--muted2);margin-top:1px;}

</style>
</head>
<body>
<div class="orb orb1"></div>
<div class="orb orb2"></div>
<div class="orb orb3"></div>

<div id="pin-screen">
  <div class="pin-logo">
    <div class="logo-icon">
       <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
         <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="#cc1f1f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
         <path d="M12 22V12" stroke="#cc1f1f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
         <path d="M12 12L21 7" stroke="#cc1f1f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
         <path d="M12 12L3 7" stroke="#cc1f1f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
       </svg>
    </div>
    <div class="pin-logo-name">FEORA <span>OIL</span></div>
    <div class="pin-logo-sub">PROFESYONEL Ã–N MUHASEBE</div>
  </div>
  <div class="pin-label" id="pin-msg">GiriÅŸ Yapmak Ä°Ã§in PIN Kodunu Girin</div>
  <div class="pin-dots" id="pin-dots">
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
  </div>
  <div class="pin-pad">
    <div class="pin-key" onclick="pinIn(1)">1</div>
    <div class="pin-key" onclick="pinIn(2)">2</div>
    <div class="pin-key" onclick="pinIn(3)">3</div>
    <div class="pin-key" onclick="pinIn(4)">4</div>
    <div class="pin-key" onclick="pinIn(5)">5</div>
    <div class="pin-key" onclick="pinIn(6)">6</div>
    <div class="pin-key" onclick="pinIn(7)">7</div>
    <div class="pin-key" onclick="pinIn(8)">8</div>
    <div class="pin-key" onclick="pinIn(9)">9</div>
    <div class="pin-key action" onclick="pinClear()">C</div>
    <div class="pin-key" onclick="pinIn(0)">0</div>
    <div class="pin-key action" onclick="pinDel()">âŒ«</div>
  </div>
  <div class="pin-err" id="pin-err"></div>
  <div class="pin-setup-info" id="pin-setup-info">VarsayÄ±lan PIN: <b>0000</b>. <br>Ayarlardan deÄŸiÅŸtirebilirsiniz.</div>
</div>

<header id="header">
  <div class="header-logo">
    <div class="logo-icon">
       <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
         <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="#cc1f1f" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
       </svg>
    </div>
    <div class="logo-wrap">
      <div class="logo-name"><span class="feora">FEORA</span>&nbsp;<span class="oil">OIL</span></div>
      <div class="logo-sub">Ã–N MUHASEBE</div>
    </div>
  </div>
  <div class="header-right">
    <div class="kur-mini">
      <div class="kc"><span class="kc-val" id="kur-usd">...</span><span class="kc-chg up">USD</span></div>
      <div class="kc"><span class="kc-val" id="kur-eur">...</span><span class="kc-chg dn">EUR</span></div>
    </div>
    <div class="bell" onclick="showPage('settings')">
      <i class="nav-icon">âš™ï¸</i>
    </div>
  </div>
</header>

<main id="content">

  <div id="pg-dash" class="page active">
    <div id="install-banner">
      <div class="install-txt">
        <div class="install-ttl">Feora Oil UygulamasÄ±nÄ± YÃ¼kle</div>
        <div class="install-sub">HÄ±zlÄ± eriÅŸim iÃ§in ana ekrana ekle</div>
      </div>
      <button class="btn btn-teal btn-sm" id="install-btn">YÃ¼kle</button>
    </div>

    <div class="ds-hero">
      <div class="ds-hero-label">Toplam Net Kasa / Banka</div>
      <div class="ds-hero-val" id="ds-total">0,00 â‚º</div>
      <div class="ds-hero-sub">TÃ¼m hesaplardaki toplam likit varlÄ±k</div>
    </div>

    <div class="stat-row">
      <div class="sc accent-red" onclick="showPage('income')">
        <i class="sc-ico">ğŸ“ˆ</i>
        <div class="sc-lbl">GELÄ°RLER</div>
        <div class="sc-val teal" id="ds-inc">0,00 â‚º</div>
        <div class="sc-sub">Bu ay tahsil edilen</div>
      </div>
      <div class="sc accent-red" onclick="showPage('expense')">
        <i class="sc-ico">ğŸ“‰</i>
        <div class="sc-lbl">GÄ°DERLER</div>
        <div class="sc-val red" id="ds-exp">0,00 â‚º</div>
        <div class="sc-sub">Bu ay Ã¶denen</div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="card-title">ğŸ’µ KASA & BANKA</div>
        <a onclick="showPage('accounts')">TÃ¼mÃ¼</a>
      </div>
      <div class="card-body" id="ds-acc-list">
        </div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="card-title">â³ Ã–DEME ALARMLARI</div>
        <a onclick="showPage('settings')">YÃ¶net</a>
      </div>
      <div class="card-body" id="ds-alarms">
        </div>
    </div>

    <div class="card">
      <div class="card-head">
        <div class="card-title">ğŸ“Š AYLIK Ã–ZET (GELÄ°R / GÄ°DER)</div>
      </div>
      <div class="card-body">
        <div class="chart-wrap" id="ds-chart">
           </div>
      </div>
    </div>
  </div>

  <div id="pg-accounts" class="page">
    <div class="sec-title">HESAP LÄ°STESÄ°</div>
    <div id="acc-list"></div>
    <div class="empty-s" id="acc-empty">
      <div class="ei">ğŸ¦</div>
      <p>HenÃ¼z hesap tanÄ±mlanmamÄ±ÅŸ.</p>
    </div>
  </div>

  <div id="pg-income" class="page">
    <div class="search-bar">
      <input type="text" class="search-inp" placeholder="Gelirlerde ara..." oninput="filterList('inc', this.value)">
    </div>
    <div class="tabs">
      <button class="tab active" onclick="tabFilter('inc','all',this)">TÃ¼mÃ¼</button>
      <button class="tab" onclick="tabFilter('inc','TAHSÄ°L EDÄ°LDÄ°',this)">Tahsil Edildi</button>
      <button class="tab" onclick="tabFilter('inc','BEKLÄ°YOR',this)">Bekliyor</button>
    </div>
    <div id="inc-list"></div>
  </div>

  <div id="pg-expense" class="page">
    <div class="search-bar">
      <input type="text" class="search-inp" placeholder="Giderlerde ara..." oninput="filterList('exp', this.value)">
    </div>
    <div class="tabs">
      <button class="tab active" onclick="tabFilter('exp','all',this)">TÃ¼mÃ¼</button>
      <button class="tab" onclick="tabFilter('exp','Ã–DENDÄ°',this)">Ã–dendi</button>
      <button class="tab" onclick="tabFilter('exp','BEKLÄ°YOR',this)">Bekliyor</button>
    </div>
    <div id="exp-list"></div>
  </div>

  <div id="pg-customers" class="page">
    <div class="search-bar">
      <input type="text" class="search-inp" placeholder="Cari ara (MÃ¼ÅŸteri/TedarikÃ§i)..." oninput="filterList('cus', this.value)">
    </div>
    <div id="cus-list"></div>
  </div>

  <div id="pg-settings" class="page">
    <div class="sec-title">ALARM SÄ°STEMÄ°</div>
    <div class="card">
      <div class="card-body">
        <div id="set-alarms"></div>
        <button class="btn btn-ghost btn-sm btn-full" style="margin-top:10px" onclick="openModal('alarm')">+ Yeni Alarm Ekle</button>
      </div>
    </div>

    <div class="sec-title">GÃœVENLÄ°K</div>
    <div class="card">
      <div class="card-body">
        <div class="ff">
          <label class="fl">PIN KODUNU DEÄÄ°ÅTÄ°R</label>
          <div style="display:flex;gap:8px;margin-top:4px;">
            <input type="password" id="set-pin-inp" class="fi" placeholder="Yeni 4 Haneli PIN" maxlength="4" style="flex:1">
            <button class="btn btn-teal btn-sm" onclick="savePin()">GÃ¼ncelle</button>
          </div>
        </div>
      </div>
    </div>

    <div class="sec-title">VERÄ° YÃ–NETÄ°MÄ°</div>
    <div class="card">
      <div class="card-body">
        <div class="backup-actions">
           <button class="backup-btn" onclick="exportData()">
              <div class="backup-btn-ico">ğŸ“¤</div>
              <div class="backup-btn-txt">
                <div class="backup-btn-ttl">Verileri Yedekle</div>
                <div class="backup-btn-sub">TÃ¼m kayÄ±tlarÄ± JSON olarak indir</div>
              </div>
           </button>
           <button class="backup-btn" onclick="document.getElementById('import-file').click()">
              <div class="backup-btn-ico">ğŸ“¥</div>
              <div class="backup-btn-txt">
                <div class="backup-btn-ttl">YedeÄŸi Geri YÃ¼kle</div>
                <div class="backup-btn-sub">Cihazdaki .json dosyasÄ±nÄ± yÃ¼kle</div>
              </div>
           </button>
           <input type="file" id="import-file" style="display:none" accept=".json" onchange="importData(event)">
           <button class="btn btn-danger btn-full" style="margin-top:10px" onclick="clearData()">TÃ¼m Verileri SÄ±fÄ±rla</button>
        </div>
      </div>
    </div>

    <div style="text-align:center;padding:20px;opacity:.4;font-size:11px;font-weight:700;">
      FEORA OIL v3.0.0 â€” CLOUDLESS ENGINE<br>VERÄ°LERÄ°NÄ°Z SADECE BU CÄ°HAZDA SAKLANIR.
    </div>
  </div>

</main>

<div id="more-overlay" onclick="toggleMore()"></div>
<div id="more-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">HIZLI Ä°ÅLEM</div>
  <div class="sheet-grid">
    <div class="sheet-item" onclick="openModal('income')">
      <i class="sheet-item-icon">ğŸ“ˆ</i>
      <span class="sheet-item-label">Gelir Ekle</span>
      <span class="sheet-item-sub">SatÄ±ÅŸ / Tahsilat</span>
    </div>
    <div class="sheet-item" onclick="openModal('expense')">
      <i class="sheet-item-icon">ğŸ“‰</i>
      <span class="sheet-item-label">Gider Ekle</span>
      <span class="sheet-item-sub">AlÄ±ÅŸ / Ã–deme</span>
    </div>
    <div class="sheet-item" onclick="openModal('customer')">
      <i class="sheet-item-icon">ğŸ‘¤</i>
      <span class="sheet-item-label">Cari Kart</span>
      <span class="sheet-item-sub">MÃ¼ÅŸteri / TedarikÃ§i</span>
    </div>
    <div class="sheet-item" onclick="openModal('account')">
      <i class="sheet-item-icon">ğŸ¦</i>
      <span class="sheet-item-label">Hesap AÃ§</span>
      <span class="sheet-item-sub">Kasa / Banka</span>
    </div>
  </div>
</div>

<nav id="bottomnav">
  <div class="nav-tab active" onclick="showPage('dash',this)">
    <i class="nav-icon">ğŸ </i>
    <span class="nav-lbl">Ã–zet</span>
  </div>
  <div class="nav-tab" onclick="showPage('income',this)">
    <i class="nav-icon">ğŸ“ˆ</i>
    <span class="nav-lbl">Gelir</span>
  </div>
  <div class="nav-tab" style="flex:0.6;" onclick="toggleMore()">
    <div style="width:36px;height:36px;background:var(--crimson);border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;box-shadow:0 4px 12px rgba(204,31,31,.3);">+</div>
  </div>
  <div class="nav-tab" onclick="showPage('expense',this)">
    <i class="nav-icon">ğŸ“‰</i>
    <span class="nav-lbl">Gider</span>
  </div>
  <div class="nav-tab" onclick="showPage('customers',this)">
    <i class="nav-icon">ğŸ‘¥</i>
    <span class="nav-lbl">Cari</span>
  </div>
</nav>

<div class="fab" onclick="scanInvoice()">
  <i class="nav-icon">ğŸ“¸</i>
</div>

<div class="overlay" id="modal-overlay">
  <div class="modal" id="modal">
    <div class="modal-handle"></div>
    <div class="modal-head">
      <div class="modal-title" id="m-title">BaÅŸlÄ±k</div>
      <div class="modal-close" onclick="closeModal()">âœ•</div>
    </div>
    <div class="modal-body" id="m-body">
      </div>
    <div class="modal-foot">
      <button class="btn btn-ghost btn-full" onclick="closeModal()">VazgeÃ§</button>
      <button class="btn btn-primary btn-full" id="m-save-btn">Kaydet</button>
    </div>
  </div>
</div>

<div id="fat-scan-overlay">
  <div class="scan-box">
    <div class="scan-corner tl"></div><div class="scan-corner tr"></div>
    <div class="scan-corner bl"></div><div class="scan-corner br"></div>
    <div class="scan-line"></div>
    <img src="" id="scan-img-el" class="scan-img">
  </div>
  <div class="scan-status" id="scan-status">Fatura taranÄ±yor...</div>
  <div class="scan-sub" id="scan-sub">Yapay zeka verileri ayrÄ±ÅŸtÄ±rÄ±yor</div>
  <div class="scan-result-preview" id="scan-result">
     </div>
  <div style="display:flex;gap:10px;" id="scan-actions">
     <button class="btn btn-ghost btn-sm" onclick="cancelScan()">Ä°ptal</button>
     <button class="btn btn-teal btn-sm" id="scan-ok-btn" style="display:none" onclick="confirmScan()">KayÄ±tlara Ekle</button>
  </div>
</div>

<div id="print-area"></div>
<div id="toast" class="toast">Mesaj</div>

<script>
/* ============================================================
   FEORA OIL â€” PROFESSIONAL ACCOUNTING ENGINE (PWA)
   ============================================================ */

let DB = JSON.parse(localStorage.getItem('FEORA_DB_V3')) || {
  accounts: [{id:1, name:'Merkez Kasa', balance:0, type:'Kasa'}],
  transactions: [],
  customers: [],
  alarms: [],
  settings: { pin: '0000', currency: 'TRY' }
};

const KURLAR = { USD: 31.45, EUR: 34.12, GBP: 39.80 }; // SimÃ¼le kurlar
let currentFilter = { type: 'all', tab: 'all' };
let pinBuffer = "";
let deferredPrompt = null;

window.onload = () => {
  if(!DB.settings.pin) DB.settings.pin = '0000';
  updateKurlar();
  renderAll();
  
  // PIN KontrolÃ¼
  if(sessionStorage.getItem('AUTH') === 'OK') {
    document.getElementById('pin-screen').classList.add('hidden');
  }
};

function toast(m, err=false){
  const t = document.getElementById('toast');
  t.innerText = m;
  t.className = 'toast show' + (err?' err':'');
  setTimeout(()=>t.classList.remove('show'), 2500);
}

function saveDB(){
  localStorage.setItem('FEORA_DB_V3', JSON.stringify(DB));
  renderAll();
}

/* --- PIN ENGINE --- */
function pinIn(n){
  if(pinBuffer.length < 4){
    pinBuffer += n;
    updatePinDots();
    if(pinBuffer.length === 4){
      setTimeout(checkPin, 250);
    }
  }
}
function pinDel(){ pinBuffer = pinBuffer.slice(0, -1); updatePinDots(); }
function pinClear(){ pinBuffer = ""; updatePinDots(); }
function updatePinDots(){
  const dots = document.querySelectorAll('.pin-dot');
  dots.forEach((d, i) => d.classList.toggle('filled', i < pinBuffer.length));
}
function checkPin(){
  if(pinBuffer === DB.settings.pin){
    sessionStorage.setItem('AUTH', 'OK');
    document.getElementById('pin-screen').style.transition = 'opacity .4s, transform .4s';
    document.getElementById('pin-screen').style.opacity = '0';
    document.getElementById('pin-screen').style.transform = 'scale(1.1)';
    setTimeout(()=> document.getElementById('pin-screen').classList.add('hidden'), 400);
  } else {
    document.getElementById('pin-dots').classList.add('shake');
    document.getElementById('pin-err').innerText = "HatalÄ± PIN Kodu!";
    setTimeout(()=> {
      document.getElementById('pin-dots').classList.remove('shake');
      pinClear();
    }, 400);
  }
}
function savePin(){
  const p = document.getElementById('set-pin-inp').value;
  if(p.length === 4){
    DB.settings.pin = p;
    saveDB();
    toast("PIN GÃ¼ncellendi âœ“");
    document.getElementById('set-pin-inp').value = "";
  } else toast("PIN 4 hane olmalÄ±!", true);
}

/* --- NAVIGATION --- */
function showPage(pid, el){
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('pg-'+pid).classList.add('active');
  if(el){
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
  }
  if(document.getElementById('more-sheet').classList.contains('open')) toggleMore();
  renderAll();
}
function toggleMore(){
  document.getElementById('more-sheet').classList.toggle('open');
  document.getElementById('more-overlay').classList.toggle('open');
}

/* --- RENDERING --- */
function renderAll(){
  updateKurlar();
  renderDashboard();
  renderAccountList();
  renderTransactionList('inc');
  renderTransactionList('exp');
  renderCustomerList();
  renderSettingsAlarms();
}

function updateKurlar(){
  document.getElementById('kur-usd').innerText = KURLAR.USD.toFixed(2);
  document.getElementById('kur-eur').innerText = KURLAR.EUR.toFixed(2);
}

function renderDashboard(){
  let total = DB.accounts.reduce((a,b)=> a + b.balance, 0);
  document.getElementById('ds-total').innerText = formatCur(total);

  let thisMonth = new Date().getMonth();
  let inc = DB.transactions.filter(t => t.type==='inc' && t.status==='TAHSÄ°L EDÄ°LDÄ°' && new Date(t.date).getMonth() === thisMonth).reduce((a,b)=>a+b.amount,0);
  let exp = DB.transactions.filter(t => t.type==='exp' && t.status==='Ã–DENDÄ°' && new Date(t.date).getMonth() === thisMonth).reduce((a,b)=>a+b.amount,0);
  
  document.getElementById('ds-inc').innerText = formatCur(inc);
  document.getElementById('ds-exp').innerText = formatCur(exp);

  // Dash Accounts
  let html = "";
  DB.accounts.slice(0,3).forEach(acc => {
    html += `
      <div class="list-item">
        <div class="li-ico navy">${acc.type==='Banka'?'ğŸ¦':'ğŸ’°'}</div>
        <div class="li-main">
          <div class="li-title">${acc.name}</div>
          <div class="li-sub">${acc.type}</div>
        </div>
        <div class="li-right">
          <div class="li-val">${formatCur(acc.balance)}</div>
        </div>
      </div>
    `;
  });
  document.getElementById('ds-acc-list').innerHTML = html || '<div class="empty-s">Hesap bulunamadÄ±.</div>';

  // Dash Alarms
  let aHtml = "";
  DB.alarms.slice(0,3).forEach(al => {
    aHtml += `
      <div class="alarm-item">
        <div class="alarm-ico">ğŸ””</div>
        <div class="alarm-txt">
          <div class="alarm-ttl">${al.title}</div>
          <div class="alarm-dt">${al.date}</div>
        </div>
        <div class="alarm-days">${al.amount} â‚º</div>
      </div>
    `;
  });
  document.getElementById('ds-alarms').innerHTML = aHtml || '<div class="empty-s" style="padding:10px">Aktif alarm yok.</div>';

  // Dash Chart
  renderChart();
}

function renderChart(){
  const months = ['Oca','Åub','Mar','Nis','May','Haz','Tem','AÄŸu','Eyl','Eki','Kas','Ara'];
  let now = new Date();
  let html = '<div class="chart-bars-row">';
  for(let i=5; i>=0; i--){
    let m = new Date(now.getFullYear(), now.getMonth()-i, 1);
    let mIdx = m.getMonth();
    let mInc = DB.transactions.filter(t => t.type==='inc' && new Date(t.date).getMonth()===mIdx).reduce((a,b)=>a+b.amount,0);
    let mExp = DB.transactions.filter(t => t.type==='exp' && new Date(t.date).getMonth()===mIdx).reduce((a,b)=>a+b.amount,0);
    let max = Math.max(mInc, mExp, 1000);
    let hInc = (mInc/max)*60 + 5;
    let hExp = (mExp/max)*60 + 5;
    html += `
      <div class="chart-col">
        <div class="chart-bars">
          <div class="bar inc" style="height:${hInc}px"></div>
          <div class="bar exp" style="height:${hExp}px"></div>
        </div>
        <div class="chart-lbl">${months[mIdx]}</div>
      </div>
    `;
  }
  html += '</div>';
  document.getElementById('ds-chart').innerHTML = html;
}

function renderAccountList(){
  let html = "";
  DB.accounts.forEach(acc => {
    html += `
      <div class="card">
        <div class="card-body" style="padding:14px; display:flex; align-items:center; gap:12px;">
          <div class="li-ico navy">${acc.type==='Banka'?'ğŸ¦':'ğŸ’°'}</div>
          <div style="flex:1">
            <div style="font-size:14px; font-weight:700;">${acc.name}</div>
            <div style="font-size:11px; color:var(--muted2)">${acc.type}</div>
          </div>
          <div style="text-align:right">
            <div style="font-family:var(--mono); font-weight:700; color:var(--text2)">${formatCur(acc.balance)}</div>
            <button class="del-btn" onclick="deleteItem('accounts', ${acc.id})">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    `;
  });
  document.getElementById('acc-list').innerHTML = html;
  document.getElementById('acc-empty').style.display = DB.accounts.length ? 'none' : 'block';
}

function renderTransactionList(type){
  let list = DB.transactions.filter(t => t.type === type);
  // Arama filtresi vs.
  let html = "";
  list.sort((a,b)=> new Date(b.date) - new Date(a.date)).forEach(t => {
    let badge = type==='inc' ? (t.status==='TAHSÄ°L EDÄ°LDÄ°'?'b-teal':'b-orange') : (t.status==='Ã–DENDÄ°'?'b-teal':'b-red');
    html += `
      <div class="card">
        <div class="card-body" style="display:flex; align-items:center; gap:12px;">
          <div class="li-ico ${type==='inc'?'navy':'red'}">${type==='inc'?'ğŸ“¥':'ğŸ“¤'}</div>
          <div style="flex:1">
             <div style="font-size:13px; font-weight:700;">${t.desc}</div>
             <div style="font-size:11px; color:var(--muted2)">${t.customer} â€¢ ${t.date}</div>
             <div style="margin-top:6px;"><span class="badge ${badge}">${t.status}</span></div>
          </div>
          <div style="text-align:right">
             <div style="font-family:var(--mono); font-weight:700; font-size:14px; color:${type==='inc'?'var(--text2)':'var(--crimson-light)'}">${formatCur(t.amount)}</div>
             <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
                <button class="del-btn" style="font-size:12px" onclick="printInvoice(${t.id})">ğŸ–¨ï¸</button>
                <button class="del-btn" style="font-size:12px" onclick="deleteItem('transactions', ${t.id})">ğŸ—‘ï¸</button>
             </div>
          </div>
        </div>
      </div>
    `;
  });
  document.getElementById(type+'-list').innerHTML = html || '<div class="empty-s">KayÄ±t bulunamadÄ±.</div>';
}

function renderCustomerList(){
  let html = "";
  DB.customers.forEach(c => {
    html += `
      <div class="card">
        <div class="card-body" style="display:flex; align-items:center; gap:12px;">
          <div class="li-ico navy">ğŸ‘¤</div>
          <div style="flex:1">
            <div style="font-size:14px; font-weight:700;">${c.name}</div>
            <div style="font-size:11px; color:var(--muted2)">${c.phone} â€¢ ${c.city}</div>
          </div>
          <div style="text-align:right">
             <button class="del-btn" onclick="deleteItem('customers', ${c.id})">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    `;
  });
  document.getElementById('cus-list').innerHTML = html || '<div class="empty-s">Cari bulunamadÄ±.</div>';
}

function renderSettingsAlarms(){
  let html = "";
  DB.alarms.forEach(al => {
    html += `
      <div class="list-item">
        <div class="li-main">
          <div class="li-title">${al.title}</div>
          <div class="li-sub">${al.date} â€¢ ${al.amount} â‚º</div>
        </div>
        <button class="del-btn" onclick="deleteItem('alarms', ${al.id})">ğŸ—‘ï¸</button>
      </div>
    `;
  });
  document.getElementById('set-alarms').innerHTML = html || '<div class="empty-s" style="padding:10px">Alarm yok.</div>';
}

/* --- MODAL ENGINE --- */
function openModal(type){
  const body = document.getElementById('m-body');
  const title = document.getElementById('m-title');
  const saveBtn = document.getElementById('m-save-btn');
  
  let html = "";
  if(type === 'account'){
    title.innerText = "YENÄ° HESAP AÃ‡";
    html = `
      <div class="fg one"><div class="ff"><label class="fl">Hesap AdÄ±</label><input type="text" id="f-name" class="fi" placeholder="Ã–rn: Garanti BankasÄ±"></div></div>
      <div class="fg"><div class="ff"><label class="fl">TÃ¼r</label><select id="f-type" class="fi"><option>Banka</option><option>Kasa</option></select></div>
      <div class="ff"><label class="fl">AÃ§Ä±lÄ±ÅŸ Bakiyesi</label><input type="number" id="f-bal" class="fi" value="0"></div></div>
    `;
    saveBtn.onclick = () => {
      let n = document.getElementById('f-name').value;
      if(!n) return toast("Ad boÅŸ olamaz",true);
      DB.accounts.push({ id:Date.now(), name:n, type:document.getElementById('f-type').value, balance: parseFloat(document.getElementById('f-bal').value)||0 });
      saveDB(); closeModal(); toast("Hesap oluÅŸturuldu âœ“");
    };
  }
  else if(type === 'income' || type === 'expense'){
    title.innerText = type==='income' ? "GELÄ°R KAYDI" : "GÄ°DER KAYDI";
    let accs = DB.accounts.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
    let custs = DB.customers.map(c => `<option>${c.name}</option>`).join('');
    html = `
      <div class="fg one"><div class="ff"><label class="fl">AÃ§Ä±klama</label><input type="text" id="f-desc" class="fi" placeholder="Fatura, SatÄ±ÅŸ vs."></div></div>
      <div class="fg"><div class="ff"><label class="fl">Tutar (â‚º)</label><input type="number" id="f-amt" class="fi" placeholder="0.00"></div>
      <div class="ff"><label class="fl">Tarih</label><input type="date" id="f-date" class="fi" value="${new Date().toISOString().split('T')[0]}"></div></div>
      <div class="fg one"><div class="ff"><label class="fl">Cari (MÃ¼ÅŸteri/TedarikÃ§i)</label><select id="f-cus" class="fi"><option>Genel Cari</option>${custs}</select></div></div>
      <div class="fg"><div class="ff"><label class="fl">Ä°ÅŸlem HesabÄ±</label><select id="f-acc" class="fi">${accs}</select></div>
      <div class="ff"><label class="fl">Durum</label><select id="f-stat" class="fi">${type==='income'?'<option>TAHSÄ°L EDÄ°LDÄ°</option><option>BEKLÄ°YOR</option>':'<option>Ã–DENDÄ°</option><option>BEKLÄ°YOR</option>'}</select></div></div>
    `;
    saveBtn.onclick = () => {
      let amt = parseFloat(document.getElementById('f-amt').value);
      let aid = parseInt(document.getElementById('f-acc').value);
      let stat = document.getElementById('f-stat').value;
      if(!amt || !aid) return toast("Eksik bilgi!",true);
      
      DB.transactions.push({
        id: Date.now(), type: type==='income'?'inc':'exp', 
        desc: document.getElementById('f-desc').value, amount: amt,
        date: document.getElementById('f-date').value, customer: document.getElementById('f-cus').value,
        accId: aid, status: stat
      });
      
      // Bakiye gÃ¼ncelleme
      if(stat === 'TAHSÄ°L EDÄ°LDÄ°' || stat === 'Ã–DENDÄ°'){
        let acc = DB.accounts.find(a => a.id === aid);
        if(acc) acc.balance += (type==='income' ? amt : -amt);
      }
      
      saveDB(); closeModal(); toast("Ä°ÅŸlem kaydedildi âœ“");
    };
  }
  else if(type === 'customer'){
    title.innerText = "YENÄ° CARÄ° KART";
    html = `
      <div class="fg one"><div class="ff"><label class="fl">Ãœnvan / Ad Soyad</label><input type="text" id="f-name" class="fi"></div></div>
      <div class="fg"><div class="ff"><label class="fl">Telefon</label><input type="tel" id="f-tel" class="fi"></div>
      <div class="ff"><label class="fl">Åehir</label><input type="text" id="f-city" class="fi"></div></div>
      <div class="fg one"><div class="ff"><label class="fl">Vergi No / TCKN</label><input type="text" id="f-vno" class="fi"></div></div>
    `;
    saveBtn.onclick = () => {
      let n = document.getElementById('f-name').value;
      if(!n) return toast("Ad boÅŸ olamaz",true);
      DB.customers.push({ id:Date.now(), name:n, phone:document.getElementById('f-tel').value, city:document.getElementById('f-city').value, vno:document.getElementById('f-vno').value });
      saveDB(); closeModal(); toast("Cari kaydedildi âœ“");
    };
  }
  else if(type === 'alarm'){
    title.innerText = "YENÄ° ALARM";
    html = `
      <div class="fg one"><div class="ff"><label class="fl">Alarm Konusu</label><input type="text" id="f-ttl" class="fi" placeholder="Ã–rn: Kira Ã–demesi"></div></div>
      <div class="fg"><div class="ff"><label class="fl">Tarih</label><input type="date" id="f-date" class="fi" value="${new Date().toISOString().split('T')[0]}"></div>
      <div class="ff"><label class="fl">Tutar</label><input type="number" id="f-amt" class="fi"></div></div>
    `;
    saveBtn.onclick = () => {
      let t = document.getElementById('f-ttl').value;
      if(!t) return toast("Konu boÅŸ olamaz",true);
      DB.alarms.push({ id:Date.now(), title:t, date:document.getElementById('f-date').value, amount:document.getElementById('f-amt').value });
      saveDB(); closeModal(); toast("Alarm kuruldu âœ“");
    };
  }

  body.innerHTML = html;
  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(){ document.getElementById('modal-overlay').classList.remove('open'); }

/* --- TOOLS --- */
function formatCur(v){ return new Intl.NumberFormat('tr-TR', { style:'currency', currency:'TRY' }).format(v); }

function deleteItem(key, id){
  if(confirm("Bu kaydÄ± silmek istediÄŸinize emin misiniz?")){
    // EÄŸer transaction siliyorsak bakiye geri alÄ±nmalÄ±
    if(key === 'transactions'){
      let t = DB.transactions.find(x => x.id === id);
      if(t && (t.status === 'TAHSÄ°L EDÄ°LDÄ°' || t.status === 'Ã–DENDÄ°')){
        let acc = DB.accounts.find(a => a.id === t.accId);
        if(acc) acc.balance += (t.type === 'inc' ? -t.amount : t.amount);
      }
    }
    DB[key] = DB[key].filter(x => x.id !== id);
    saveDB();
    toast("Silindi âœ“");
  }
}

function filterList(type, val){
  // Basit frontend filtreleme logic buraya
}

function tabFilter(type, status, el){
  let container = el.parentElement;
  container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  // Filtreleme logic...
}

/* --- SCANNER SIMULATION --- */
function scanInvoice(){
  document.getElementById('fat-scan-overlay').classList.add('open');
  document.getElementById('scan-img-el').classList.remove('visible');
  document.getElementById('scan-result').classList.remove('open');
  document.getElementById('scan-ok-btn').style.display = 'none';
  document.getElementById('scan-status').innerText = "Fatura taranÄ±yor...";

  setTimeout(()=>{
    document.getElementById('scan-img-el').src = "https://images.unsplash.com/photo-1554224155-1696413565d3?w=400"; // Dummy
    document.getElementById('scan-img-el').classList.add('visible');
    document.getElementById('scan-status').innerText = "Veriler ayrÄ±ÅŸtÄ±rÄ±lÄ±yor...";
    
    setTimeout(()=>{
      document.getElementById('scan-status').innerText = "Tarama BaÅŸarÄ±lÄ±!";
      document.getElementById('scan-result').classList.add('open');
      document.getElementById('scan-ok-btn').style.display = 'block';
      document.getElementById('scan-result').innerHTML = `
        <div class="scan-field"><span class="scan-field-key">Firma:</span><span class="scan-field-val">Petrol Ofisi A.Å.</span></div>
        <div class="scan-field"><span class="scan-field-key">Tarih:</span><span class="scan-field-val">12.03.2024</span></div>
        <div class="scan-field"><span class="scan-field-key">Tutar:</span><span class="scan-field-val">2.450,00 â‚º</span></div>
        <div class="scan-field"><span class="scan-field-key">KDV:</span><span class="scan-field-val">490,00 â‚º</span></div>
      `;
    }, 1500);
  }, 2000);
}
function cancelScan(){ document.getElementById('fat-scan-overlay').classList.remove('open'); }
function confirmScan(){
  DB.transactions.push({
    id: Date.now(), type: 'exp', desc: 'AkaryakÄ±t AlÄ±mÄ± (Tarama)', amount: 2450,
    date: '2024-03-12', customer: 'Petrol Ofisi A.Å.', accId: DB.accounts[0].id, status: 'Ã–DENDÄ°'
  });
  let acc = DB.accounts[0];
  if(acc) acc.balance -= 2450;
  saveDB();
  cancelScan();
  toast("Fatura kaydedildi âœ“");
}

/* --- PRINT SYSTEM --- */
function printInvoice(id){
  let t = DB.transactions.find(x => x.id === id);
  if(!t) return;
  const area = document.getElementById('print-area');
  area.innerHTML = `
    <div class="print-invoice">
      <div class="print-header">
        <div>
          <div class="print-company">FEORA OIL LTD. ÅTÄ°.</div>
          <div class="print-company-sub">Saray Mah. Enerji Cad. No:44 Kat:8 D:12 Ã‡ankaya/ANKARA<br>Mersis: 0123456789012345 â€” Tel: 0850 123 45 67</div>
        </div>
        <div class="print-inv-info">
          <div style="font-size:10px; color:#888;">BELGE NO</div>
          <div class="print-inv-no">#INV-${t.id.toString().slice(-6)}</div>
          <div style="font-size:11px; margin-top:5px;">TARÄ°H: ${t.date}</div>
        </div>
      </div>
      <div class="print-parties">
        <div>
          <div class="print-party-label">HÄ°ZMET VEREN</div>
          <div class="print-party-name">Feora Oil Accounting</div>
          <div class="print-party-info">Vergi Dairesi: Hitit<br>VKN: 3840661234</div>
        </div>
        <div>
          <div class="print-party-label">HÄ°ZMET ALAN (CARÄ°)</div>
          <div class="print-party-name">${t.customer}</div>
          <div class="print-party-info">SayÄ±n Ä°lgili,<br>Bu belge cari iÅŸlem kaydÄ± dÃ¶kÃ¼mÃ¼dÃ¼r.</div>
        </div>
      </div>
      <table class="print-table">
        <thead><tr><th>AÃ‡IKLAMA</th><th>MÄ°KTAR</th><th>B.FÄ°YAT</th><th>TOPLAM</th></tr></thead>
        <tbody>
          <tr>
            <td>${t.desc}</td>
            <td>1 Adet</td>
            <td>${t.amount.toFixed(2)} â‚º</td>
            <td>${t.amount.toFixed(2)} â‚º</td>
          </tr>
        </tbody>
      </table>
      <div class="print-totals">
        <div class="print-total-row"><span>Ara Toplam</span><span>${t.amount.toFixed(2)} â‚º</span></div>
        <div class="print-total-row"><span>KDV (%0)</span><span>0,00 â‚º</span></div>
        <div class="print-total-row final"><span>GENEL TOPLAM</span><span>${t.amount.toFixed(2)} â‚º</span></div>
      </div>
      <div style="text-align:right; margin-top:20px;">
        <div class="print-stamp">TAHSÄ°L EDÄ°LMÄ°ÅTÄ°R</div>
      </div>
      <div class="print-footer">
        Bu belge Feora Oil Ã–n Muhasebe Sistemi Ã¼zerinden dijital olarak oluÅŸturulmuÅŸtur.<br>
        Elektronik imza Kanunu uyarÄ±nca Ä±slak imza gerektirmeyebilir.
      </div>
    </div>
  `;
  window.print();
}

/* --- BACKUP & SYNC --- */
function exportData(){
  const blob = new Blob([JSON.stringify(DB, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `feora-oil-backup-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
}
function importData(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const data = JSON.parse(ev.target.result);
      if(data.accounts && data.transactions){
        DB = data;
        saveDB();
        toast("Yedek baÅŸarÄ±yla yÃ¼klendi âœ“");
      }
    } catch(e) { toast("GeÃ§ersiz yedek dosyasÄ±!", true); }
  };
  reader.readAsText(file);
}
function clearData(){
  if(confirm("TÃœM VERÄ°LER SÄ°LÄ°NECEK! Emin misiniz?")){
    localStorage.removeItem('FEORA_DB_V3');
    location.reload();
  }
}

/* --- PWA & MISC --- */
let deferredPrompt;
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();deferredPrompt=e;
  document.getElementById('install-banner').classList.add('show');
});
document.getElementById('install-btn').addEventListener('click',async()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    const{outcome}=await deferredPrompt.userChoice;
    if(outcome==='accepted'){toast('Feora Oil yÃ¼kleniyor! âœ“');document.getElementById('install-banner').classList.remove('show');}
    deferredPrompt=null;
  } else {
    toast('Safari â€º PaylaÅŸ â€º Ana Ekrana Ekle ');
  }
});
window.addEventListener('appinstalled',()=>{toast('Feora Oil yÃ¼klendi! âœ“');document.getElementById('install-banner').classList.remove('show');});

if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{navigator.serviceWorker.register('./sw.js').then(()=>{}).catch(()=>{});});
}
const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
const isStandalone=window.matchMedia('(display-mode: standalone)').matches;
if(isIOS&&!isStandalone){ setTimeout(()=>document.getElementById('install-banner').classList.add('show'),2500); }

// DÃ¶viz simÃ¼lasyonu (8 saniyede bir kÃ¼Ã§Ã¼k dalgalanma)
setInterval(()=>{
  ['USD','EUR'].forEach(k=>{
    const c=(Math.random()-.48)*.08;
    KURLAR[k]=+(KURLAR[k]+c).toFixed(2);
  });
  updateKurlar();
}, 8000);

</script>
</body>
</html>
