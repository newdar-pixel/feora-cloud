<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feora Cloud</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#0a0a12;
  color:white;
}
header{
  text-align:center;
  padding:15px;
  border-bottom:2px solid #d10000;
}
.dashboard{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:15px;
}
.card{
  background:#0b1a4a;
  padding:14px;
  border-radius:12px;
}
.val{font-size:18px;margin-top:6px;font-weight:bold}
button{
  background:#d10000;
  border:none;
  padding:8px 12px;
  color:white;
  border-radius:6px;
  margin:4px;
}
table{
  width:100%;
  font-size:12px;
  border-collapse:collapse;
}
td,th{
  padding:6px;
  border-bottom:1px solid #222;
}
.login-box{
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:30px;
}
input{
  padding:10px;
  border-radius:6px;
  border:none;
}
</style>
</head>
<body>

<div id="loginScreen" class="login-box">
  <h2>Giriş Yap</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Şifre">
  <button onclick="login()">Giriş</button>
</div>

<div id="app" style="display:none">

<header>
<h2>Feora Cloud Finans</h2>
</header>

<div class="dashboard">
<div class="card"><div>Nakit</div><div class="val" id="kasa">0</div></div>
<div class="card"><div>Alacak</div><div class="val" id="alacak">0</div></div>
<div class="card"><div>Borç</div><div class="val" id="borc">0</div></div>
<div class="card"><div>Net Kar</div><div class="val" id="kar">0</div></div>
</div>

<div style="text-align:center;">
<button onclick="gelir()">Gelir</button>
<button onclick="gider()">Gider</button>
<button onclick="tahsilat()">Tahsilat</button>
<button onclick="odeme()">Ödeme</button>
</div>

<table>
<thead>
<tr><th>Tarih</th><th>Tip</th><th>Tutar</th><th></th></tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB67ll8JL4UQhv2z-nV-j8VNdOdWpXNdDY",
  authDomain: "feora-finans.firebaseapp.com",
  projectId: "feora-finans",
  storageBucket: "feora-finans.firebasestorage.app",
  messagingSenderId: "190320479090",
  appId: "1:190320479090:web:8cc249c9688db5b427ebeb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let DB = [];
let colRef;

window.login = async ()=>{
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;
  await signInWithEmailAndPassword(auth,email,pass)
    .catch(()=>alert("Giriş Hatalı"));
};

onAuthStateChanged(auth,(user)=>{
  if(user){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("app").style.display="block";
    colRef = collection(db,"transactions");

    onSnapshot(colRef,(snapshot)=>{
      DB = snapshot.docs.map(d=>({id:d.id,...d.data()}));
      render();
    });
  }
});

function tl(x){
  return x.toLocaleString("tr-TR",{style:"currency",currency:"TRY"});
}

function calculate(){
  let L={gelir:0,gider:0,kasa:0,alacak:0,borc:0};
  DB.forEach(t=>{
    if(t.type==="gelir") L.gelir+=t.amount;
    if(t.type==="gider") L.gider+=t.amount;
    if(t.type==="tahsilat") L.kasa+=t.amount;
    if(t.type==="odeme") L.kasa-=t.amount;
  });
  L.netKar=L.gelir-L.gider;
  return L;
}

function render(){
  const L=calculate();
  document.getElementById("kasa").innerText=tl(L.kasa);
  document.getElementById("alacak").innerText=tl(L.alacak||0);
  document.getElementById("borc").innerText=tl(L.borc||0);
  document.getElementById("kar").innerText=tl(L.netKar);

  const list=document.getElementById("list");
  list.innerHTML="";
  DB.slice().reverse().forEach(t=>{
    list.innerHTML+=`
    <tr>
      <td>${new Date(t.date).toLocaleDateString()}</td>
      <td>${t.type}</td>
      <td>${tl(t.amount)}</td>
      <td><button onclick="sil('${t.id}')">X</button></td>
    </tr>`;
  });
}

window.gelir = async ()=>{
  const amount=Number(prompt("Gelir Tutarı"));
  if(!amount) return;
  await addDoc(colRef,{type:"gelir",amount,date:new Date().toISOString()});
};

window.gider = async ()=>{
  const amount=Number(prompt("Gider Tutarı"));
  if(!amount) return;
  await addDoc(colRef,{type:"gider",amount,date:new Date().toISOString()});
};

window.tahsilat = async ()=>{
  const amount=Number(prompt("Tahsilat"));
  if(!amount) return;
  await addDoc(colRef,{type:"tahsilat",amount,date:new Date().toISOString()});
};

window.odeme = async ()=>{
  const amount=Number(prompt("Ödeme"));
  if(!amount) return;
  await addDoc(colRef,{type:"odeme",amount,date:new Date().toISOString()});
};

window.sil = async (id)=>{
  await deleteDoc(doc(db,"transactions",id));
};

</script>

</body>
</html>
